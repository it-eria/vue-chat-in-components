(function(e){function t(t){for(var a,r,o=t[0],c=t[1],l=t[2],g=0,f=[];g<o.length;g++)r=o[g],n[r]&&f.push(n[r][0]),n[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return i.push.apply(i,l||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],a=!0,o=1;o<s.length;o++){var c=s[o];0!==n[c]&&(a=!1)}a&&(i.splice(t--,1),e=r(r.s=s[0]))}return e}var a={},n={app:0},i=[];function r(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=a,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0860":function(e,t,s){e.exports=s.p+"img/avatar-1.029703f7.jpg"},"0b0e":function(e,t,s){e.exports=s.p+"img/toggle.a3c2c70d.svg"},"0c7b":function(e,t,s){"use strict";var a=s("9e70"),n=s.n(a);n.a},"0dc3":function(e,t,s){e.exports=s.p+"img/photo-3.b78d526b.jpg"},"106f":function(e,t,s){},"17dc":function(e,t,s){e.exports=s.p+"img/video.c3b59b25.svg"},"1c86":function(e,t,s){e.exports=s.p+"img/avatar-3.bd1d5004.jpg"},"1d1b":function(e,t,s){e.exports=s.p+"img/close.15242658.svg"},"1fd6":function(e,t,s){e.exports=s.p+"img/photo-4.1649e763.jpg"},2:function(e,t){},3:function(e,t){},4:function(e,t){},"4a4f":function(e,t,s){e.exports=s.p+"img/photo-2.78ced74b.jpg"},"4de0":function(e,t,s){e.exports=s.p+"img/upload-1.7dab34e3.jpg"},5:function(e,t){},"56d7":function(e,t,s){"use strict";s.r(t);s("cadf"),s("551c");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return Object.keys(e.users).length>0&&e.messages.length>0?s("div",{attrs:{id:"chat-app"},on:{scroll:function(t){e.loadMore(t)}}},[s("SendFormComponent",{attrs:{general:!0}}),s("transition-group",{attrs:{name:"flip-list",tag:"div"}},e._l(e.messages,function(t){return s("MessageComponent",{key:t.id,attrs:{message:t,users:e.users}})}))],1):e._e()},i=[],r=(s("ac6a"),s("456d"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:[e.general?"b-chat b-chat--task":null]},[e.general?e._e():s("div",{staticClass:"b-chat__aside"},[s("a",{staticClass:"toggle-btn",attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.collapse.collapse=!e.collapse.collapse}}})]),s("div",{staticClass:"b-chat__title"},[s("h2",[e._v(e._s(e.groupName))])]),s("div",{staticClass:"b-chat__send-form"},[s("div",{staticClass:"form"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"b-chat__send-form__textarea",attrs:{placeholder:"Type your message..."},domProps:{value:e.message},on:{keyup:function(t){e.AutoGrowTextArea(t.target)},input:function(t){t.target.composing||(e.message=t.target.value)}}}),s("emoji-picker",{staticClass:"b-chat__send-form__emoji-btn",attrs:{search:e.search},on:{emoji:e.insert},scopedSlots:e._u([{key:"emoji-invoker",fn:function(t){var a=t.events;return s("button",e._g({staticClass:"emoji--toggle-popup"},a))}},{key:"emoji-picker",fn:function(t){var a=t.emojis,n=t.insert;t.display;return s("div",{},[s("div",{staticClass:"emoji-picker"},[s("div",{staticClass:"emoji-picker__search"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],attrs:{type:"text"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})]),s("div",e._l(a,function(t,a){return s("div",{key:a},[s("h5",[e._v(e._s(a))]),s("div",{staticClass:"emojis"},e._l(t,function(t,a){return s("span",{key:a,attrs:{title:a},on:{click:function(e){n(t)}}},[e._v(e._s(t))])}))])}))])])}}])}),s("div",{staticClass:"b-chat__send-form__upload-btn",on:{change:function(t){e.addFiles(t)}}},[s("label",{attrs:{for:"upload-files"}}),s("input",{attrs:{type:"file",multiple:"",id:"upload-files"}})]),s("button",{staticClass:"b-chat__send-form__send-btn",on:{click:function(t){t.preventDefault(),e.addMessage(e.message)}}},[e._v("Send")])],1),s("div",{staticClass:"uploaded-files-preview"},[s("transition-group",{attrs:{name:"list-complete",tag:"div"}},e._l(e.filesBuffer,function(t){return s("div",{key:t.id,class:e.getClass(t.type)},[s("div",{staticClass:"img-miniature"},[s("button",{staticClass:"close-btn",on:{click:function(s){s.preventDefault(),e.removeFile(t.id)}}}),s("img",{attrs:{src:t.preview?t.preview:e.getIconPath(t.type),alt:"thumbnail"}}),s("div",{staticClass:"b-uploading",attrs:{id:t.id}},[e._v("\n              Loading...\n            ")])]),s("span",[e._v(e._s(e.viewName(t.name)))])])}))],1)])])}),o=[],c=(s("7f7f"),s("669f")),l=s.n(c),u=s("574c"),g=s.n(u),f=s("59ca"),d=s.n(f),m=(s("66ce"),s("588e"),d.a.initializeApp({apiKey:"AIzaSyAC6QK-sCeYF_X8HmM1oCCqhYwWeEFOakg",authDomain:"test-chat-c8873.firebaseapp.com",databaseURL:"https://test-chat-c8873.firebaseio.com",projectId:"test-chat-c8873",storageBucket:"test-chat-c8873.appspot.com",messagingSenderId:"670720421431"})),p=m.database(),h=m.storage(),v="chat-room-1",_="-LJ8Eq2DI86nwGLn8e62",b={components:{EmojiPicker:l.a},props:{general:Boolean,collapse:Object,groupName:String,sendTo:String},data:function(){return{message:"",search:"",filesBuffer:[],isFilesUploaded:!1}},methods:{AutoGrowTextArea:function(e){e.clientHeight<e.scrollHeight&&(e.style.height=e.scrollHeight+"px",e.clientHeight<e.scrollHeight&&(e.style.height=2*e.scrollHeight-e.clientHeight+"px"))},insert:function(e){this.message+=e},getClass:function(e){var t="list-complete-item b-file";return t+="image"==e?" b-file--photo":" list-complete-item b-file--"+e,t},getIconPath:function(e){var t="";switch(e){case"video":t="video.svg";break;case"archive":t="archive.svg";break;case"document":t="document.svg";break}return s("bb6e")("./"+t)},addFiles:function(e){this.isFilesUploaded&&(this.filesBuffer=[],this.isFilesUploaded=!1);for(var t=e.target.files,s=0;s<t.length;s++){var a=Math.floor(999999999*Math.random()),n="",i=g.a.lookup(t[s].name),r=null;/image/.test(i)?(n="image",r=window.URL.createObjectURL(t[s])):/x-rar-compressed/.test(i)||/zip/.test(i)?n="archive":/officedocument/.test(i)||/msword/.test(i)||/text/.test(i)||/pdf/.test(i)?n="document":/video/.test(i)&&(n="video"),this.filesBuffer.push({id:a,name:t[s].name,newName:a+t[s].name,type:n,preview:r,file:t[s],downloadUrl:""})}e.target.value=""},removeFile:function(e){for(var t=0,s=0;s<this.filesBuffer.length;s++)if(t=s,this.filesBuffer[s].id==e)break;this.filesBuffer.splice(t,1)},addMessage:function(e){var t=this,s=this,a=d.a.database.ServerValue.TIMESTAMP,n=this.general?"messages":"messages/"+this.sendTo+"/msgGr",i=p.ref(v).child(n).push();this.isFilesUploaded&&(this.filesBuffer=[],this.isFilesUploaded=!1),this.general||p.ref(v).child("messages/"+this.sendTo).update({updateAt:a}),this.filesBuffer.length>0?function(){for(var n=0,r=function(r){document.getElementById(s.filesBuffer[r].id).style.opacity=1,h.ref("upload").child(t.filesBuffer[r].newName).put(t.filesBuffer[r].file).then(function(e){return document.getElementById(s.filesBuffer[r].id).classList.add("b-uploading--success"),document.getElementById(s.filesBuffer[r].id).innerHTML="Success",e.ref.getDownloadURL()}).then(function(o){document.getElementById(s.filesBuffer[r].id).parentNode.parentNode.style.display="none",n++,s.filesBuffer[r].downloadUrl=o,n==s.filesBuffer.length&&(i.update({msg:e,from:_,updateAt:a,files:s.filesBuffer}),t.message="",t.isFilesUploaded=!0)})},o=0;o<t.filesBuffer.length;o++)r(o)}():(i.update({msg:e,from:_,updateAt:a}),this.message=""),document.getElementById("chat-app").scrollTo(0,0)},viewName:function(e){var t=e;if(e.length>16){var s=e.substr(0,7),a=e.substr(e.length-7,e.length-1);t=s+" ... "+a}return t}}},y=b,k=(s("9892"),s("2877")),C=Object(k["a"])(y,r,o,!1,null,null,null),w=C.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:[e.collapseMessageGroup.collapse?"b-chat b-chat--single b-chat--task closed":"b-chat b-chat--single b-chat--task"],on:{scroll:function(t){e.loadMore(t)}}},[e.message.msgGr?a("SendFormComponent",{attrs:{general:!1,collapse:e.collapseMessageGroup,groupName:e.message.groupName,sendTo:e.message.id}}):e._e(),e.message.msgGr?a("div",e._l(e.messageArr,function(t){return t.from?a("div",{key:t.id,staticClass:"b-chat__message b-chat__task"},[a("div",{staticClass:"b-chat__message__user-avatar"},[a("img",{attrs:{src:e.users[t.from].avatar||s("889b"),alt:"user avatar"}})]),a("div",{staticClass:"b-chat__message__inf-line"},[a("h4",[e._v(e._s(e.users[t.from].name))]),a("span",[e._v(e._s(e.getDate(t.updateAt)))]),a("span",[e._v(e._s(e.getTime(t.updateAt)))])]),a("div",{staticClass:"b-chat__message__message-line"},[a("p",{domProps:{innerHTML:e._s(e.findLinksInMessage(t.msg))}})]),t.files?a("div",{staticClass:"b-chat__message__files-line"},[a("div",{staticClass:"non-photos"},e._l(t.files,function(t){return"image"!=t.type?a("a",{key:t.id,class:e.getFileMiniatureClass(t.type),attrs:{href:t.downloadUrl,target:"_blank"}},[a("img",{attrs:{src:e.getIconPath(t.type),alt:"video"}}),a("span",[e._v(e._s(e.viewName(t.name)))])]):e._e()})),a("div",{staticClass:"photos"},e._l(t.files,function(t){return"image"==t.type?a("a",{key:t.id,attrs:{href:t.downloadUrl,target:"_blank"}},[a("img",{attrs:{src:t.downloadUrl,alt:t.name}})]):e._e()}))]):e._e()]):e._e()})):e._e(),!e.message.msgGr&&e.message.from?a("div",[a("div",{staticClass:"b-chat__message b-chat__task"},[a("div",{staticClass:"b-chat__message__user-avatar"},[a("img",{attrs:{src:e.users[e.message.from].avatar||s("889b"),alt:"user avatar"}})]),a("div",{staticClass:"b-chat__message__inf-line"},[a("h4",[e._v(e._s(e.users[e.message.from].name))]),a("span",[e._v(e._s(e.getDate(e.message.updateAt)))]),a("span",[e._v(e._s(e.getTime(e.message.updateAt)))])]),a("div",{staticClass:"b-chat__message__message-line",attrs:{id:"msg-"+e.message.updateAt}},[a("p",{domProps:{innerHTML:e._s(e.findLinksInMessage(e.message.msg,"msg-"+e.message.updateAt))}})]),e.message.files?a("div",{staticClass:"b-chat__message__files-line"},[a("div",{staticClass:"non-photos"},e._l(e.message.files,function(t){return"image"!=t.type?a("a",{key:t.id,class:e.getFileMiniatureClass(t.type),attrs:{href:t.downloadUrl,target:"_blank"}},[a("img",{attrs:{src:e.getIconPath(t.type),alt:"video"}}),a("span",[e._v(e._s(e.viewName(t.name)))])]):e._e()})),a("div",{staticClass:"photos"},e._l(e.message.files,function(t){return"image"==t.type?a("a",{key:t.id,attrs:{href:t.downloadUrl,target:"_blank"}},[a("img",{attrs:{src:t.downloadUrl,alt:t.name}})]):e._e()}))]):e._e()])]):e._e()],1)},T=[],M=(s("b54a"),s("71cc")),x=s.n(M),A=s("02cc"),O=s.n(A),B=s("30dc"),I=s.n(B),E={components:{SendFormComponent:w},props:{message:Object,users:Object},data:function(){return{collapseMessageGroup:{collapse:!0},countOfMessages:0,limitTo:5,submessages:[],currentId:this.message.id}},computed:{messageArr:function(){var e=[];for(var t in this.submessages){var s=this.submessages[t];s.id=t,e.push(s)}return e}},created:function(){var e=this;this.message.msgGr&&(console.log(this.message.groupName+" - "+this.currentId),p.ref(v).child("messages/"+this.currentId).child("msgGr").once("value",function(t){e.countOfMessages=Object.keys(t.val()).length}),p.ref(v).child("messages/"+this.currentId).child("msgGr").orderByChild("updateAt").limitToLast(this.limitTo).on("value",function(t){e.submessages=[],t.forEach(function(t){var s=t.val();s["id"]=t.key,e.submessages.unshift(s)})}))},methods:{loadMore:function(e){var t=e.target,s=parseFloat(t.scrollHeight),a=t.scrollTop+t.clientHeight;if(a==s&&this.limitTo<=this.countOfMessages){var n=this;p.ref(v).child("messages/"+this.currentId).child("msgGr").off("value"),this.limitTo+=5,p.ref(v).child("messages/"+this.currentId).child("msgGr").orderByChild("updateAt").limitToLast(this.limitTo).on("value",function(e){n.submessages=[],e.forEach(function(e){var t=e.val();t["id"]=e.key,n.submessages.unshift(t)})})}},getDate:function(e){var t=new Date(e),s=t.getFullYear(),a=t.getMonth(),n=t.getDate(),i=+a+1<10?"0"+(+a+1):+a+1,r=+n<10?"0"+n:n;return s+"."+i+"."+r},getTime:function(e){var t=new Date(e),s=t.getHours(),a=t.getMinutes(),n=+a<10?"0"+a:a;return s+":"+n},viewName:function(e){var t=e;if(e.length>16){var s=e.substr(0,7),a=e.substr(e.length-7,e.length-1);t=s+" ... "+a}return t},getFileMiniatureClass:function(e){return"file-link file-link--"+e},getIconPath:function(e){var t="";switch(e){case"video":t="video.svg";break;case"archive":t="archive.svg";break;case"document":t="document.svg";break}return s("bb6e")("./"+t)},findLinksInMessage:function(e,t){var s=x.a.link(e,{className:"link-at-message"}),a=document.createElement("div");a.innerHTML=s;var n=a.querySelectorAll("a").length;if(n){var i=a.querySelectorAll("a")[n-1],r=i.href,o="https://";(/https:\/\//g.test(r)||/http:\/\//g.test(r))&&(o="");var c={url:o+r,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,PUT,POST,DELETE,OPTIONS","Access-Control-Allow-Headers":"Content-type,Accept,X-Access-Token,X-Key"}};I.a.get(c,function(e,s,n){if(!e&&200==s.statusCode){var i=O.a.load(n),o={ogTitle:i('meta[property="og:title"]').attr("content"),ogUrl:i('meta[property="og:url"]').attr("content"),ogImage:i('meta[property="og:image"]').attr("content"),ogImageAlt:i('meta[property="og:image:alt"]').attr("content"),ogDescription:i('meta[property="og:description"]').attr("content")};0==document.getElementById(t).querySelectorAll(".og-meta").length&&o.ogTitle&&(a.innerHTML='\n                <a href="'.concat(o.ogUrl||"",'" target="_blank" class="og-meta">\n                  <div class="og-meta__img">\n                      <img src="').concat(o.ogImage||"no-src",'" alt="').concat(o.ogImageAlt,'">\n                  </div>\n                  <div class="og-meta__inf">\n                    <span>').concat(o.ogUrl||r,"</span>\n                    <h4>").concat(o.ogTitle||"","</h4>\n                    <p>").concat(o.ogDescription||"","</p>\n                  </div>\n                </a>"),document.getElementById(t).appendChild(a))}})}return s}}},U=E,F=(s("0c7b"),Object(k["a"])(U,j,T,!1,null,null,null)),L=F.exports,S={name:"chat-app",components:{SendFormComponent:w,MessageComponent:L},data:function(){return{limitTo:5,messages:[],users:{},countOfMessages:0}},computed:{messageGlobalArr:function(){var e=[];for(var t in this.messages){var s=this.messages[t];s.id=t,e.push(s)}return e.reverse()}},created:function(){var e=this,t=this;p.ref(v).child("messages").once("value",function(e){t.countOfMessages=Object.keys(e.val()).length}),p.ref("users").once("value").then(function(t){e.users=t.val()}),p.ref(v+"/messages").orderByChild("updateAt").limitToLast(this.limitTo).on("value",function(e){t.messages=[],e.forEach(function(e){var s=e.val();s["id"]=e.key,t.messages.unshift(s)})})},methods:{loadMore:function(e){var t=e.target,s=parseFloat(t.scrollHeight),a=t.scrollTop+document.body.clientHeight;if(a==s&&this.limitTo<=this.countOfMessages){var n=this;p.ref(v+"/messages").off("value"),this.limitTo+=5,p.ref(v+"/messages").orderByChild("updateAt").limitToLast(this.limitTo).on("value",function(e){n.messages=[],e.forEach(function(e){var t=e.val();t["id"]=e.key,n.messages.unshift(t)})})}}}},N=S,P=(s("5c0b"),Object(k["a"])(N,n,i,!1,null,null,null)),D=P.exports,H=s("0ff2"),G=s("e6d1"),q=s.n(G);a["a"].use(H["a"]),a["a"].use(q.a),a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(D)}}).$mount("#app")},"5c0b":function(e,t,s){"use strict";var a=s("106f"),n=s.n(a);n.a},"5fe1":function(e,t,s){e.exports=s.p+"img/document.2bcf080d.svg"},6:function(e,t){},7:function(e,t){},"889b":function(e,t,s){e.exports=s.p+"img/default-avatar.c2a08a3f.png"},"8ea1":function(e,t,s){e.exports=s.p+"img/archive.a84c89ff.svg"},9892:function(e,t,s){"use strict";var a=s("f10f"),n=s.n(a);n.a},"9e70":function(e,t,s){},bb6e:function(e,t,s){var a={"./archive.svg":"8ea1","./avatar-1.jpg":"0860","./avatar-2.jpg":"cbe0","./avatar-3.jpg":"1c86","./close.svg":"1d1b","./default-avatar.png":"889b","./document.svg":"5fe1","./emoji.svg":"d99d","./photo-1.jpg":"ccf6","./photo-2.jpg":"4a4f","./photo-3.jpg":"0dc3","./photo-4.jpg":"1fd6","./toggle.svg":"0b0e","./upload-1.jpg":"4de0","./upload.svg":"c93a","./video.svg":"17dc"};function n(e){var t=i(e);return s(t)}function i(e){var t=a[e];if(!(t+1)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return t}n.keys=function(){return Object.keys(a)},n.resolve=i,e.exports=n,n.id="bb6e"},bf22:function(e,t){function s(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}s.keys=function(){return[]},s.resolve=s,e.exports=s,s.id="bf22"},c93a:function(e,t,s){e.exports=s.p+"img/upload.42ddaea2.svg"},cbe0:function(e,t,s){e.exports=s.p+"img/avatar-2.5aa981f1.jpg"},ccf6:function(e,t,s){e.exports=s.p+"img/photo-1.e2489ce6.jpg"},d99d:function(e,t,s){e.exports=s.p+"img/emoji.c0ba760a.svg"},f10f:function(e,t,s){}});
//# sourceMappingURL=app.49374599.js.map